# Dynamic Server Setup Script

This repository provides a powerful, reusable, and modular script to automate the setup of servers for hosting, mail, and DNS services. It supports ISPConfig, DKIM, SPF, and SSL configurations, and is ideal for setting up name servers (`ns1` and `ns2`).

---

## Features

- **Dynamic IP and Domain Configuration**: Supports dynamic user input or pre-configured settings via a configuration file.
- **Reusable Design**: Modularized with functions for selective task execution.
- **Automated ISPConfig Installation**: Simplifies the complex setup of ISPConfig.
- **Name Server Setup**: Configures `ns1` and `ns2` for your domain.
- **Email Server Integration**: Includes Postfix, DKIM, and SPF for secure email services.
- **Optional SSL Installation**: Easily add Let's Encrypt SSL for secure connections.
- **Error Handling**: Checks and validates files, folders, and configurations to avoid redundancy.

---

## Quick Start

### 1. Clone the Repository

```bash
git clone https://github.com/username/server-setup-automation.git
cd server-setup-automation
```

---

### 2. Configuration

#### Option 1: Use a Configuration File

1. Open and edit the `setup_config.conf` file:
   ```bash
   nano setup_config.conf
   ```

2. Update the values to match your setup:
   ```plaintext
   DOMAIN="raketeros.com"
   HOSTNAME="mail.raketeros.com"
   SERVER_IP="your_server_ip"
   MYSQL_ROOT_PASSWORD="your_mysql_password"
   ISP_DB_NAME="dbispconfig"
   ISP_DB_USER="ispconfig_user"
   ISP_DB_PASSWORD="your_ispconfig_password"
   INSTALL_SSL="yes"
   ```

#### Option 2: Dynamic Inputs

Run the script without a configuration file. It will prompt you for all required inputs.

---

### 3. Run the Script

Make the script executable and start the setup:

```bash
chmod +x setup_server.sh
sudo ./setup_server.sh
```

---

## Menu Options

When the script runs, a menu allows selective execution of tasks:

1. **Install Prerequisites**: Update and install required packages.
2. **Set Hostname**: Configure the hostname and `/etc/hosts`.
3. **Configure MySQL**: Set up MySQL databases and users.
4. **Install ISPConfig**: Download and install ISPConfig.
5. **Configure Postfix**: Set up the Postfix mail server.
6. **Configure OpenDKIM**: Set up DKIM for email authentication.
7. **Configure Bind9**: Configure DNS for `ns1` and `ns2`.
8. **Install SSL**: Add Let's Encrypt SSL certificates.
9. **Exit**: Quit the script.

---

## DNS Records

### Required DNS Records

| Type  | Name             | Value                       |
|-------|------------------|-----------------------------|
| A     | `@`              | `<your_server_ip>`          |
| A     | `ns1`            | `<your_server_ip>`          |
| A     | `ns2`            | `<your_server_ip>`          |
| A     | `mail`           | `<your_server_ip>`          |
| MX    | `@`              | `mail.raketeros.com (Priority 10)` |
| TXT   | `_dmarc`         | `v=DMARC1; p=none;`         |
| TXT   | `@`              | `v=spf1 a mx ip4:<your_server_ip> ~all` |
| TXT   | `mail._domainkey`| DKIM public key (generated by the script) |

---

## Post-Setup Verification

1. **Verify DNS Configuration**:
   Use [MXToolbox](https://mxtoolbox.com/) or `dig` to check DNS propagation.
   ```bash
   dig ns raketeros.com
   ```

2. **Test Email Deliverability**:
   Send test emails to confirm DKIM, SPF, and MX are functioning correctly.

3. **Access ISPConfig**:
   Log in to ISPConfig at:
   ```plaintext
   https://mail.raketeros.com:8080
   ```

---

## Troubleshooting

- **Log Files**:
  - Postfix: `/var/log/mail.log`
  - Bind9: `/var/log/syslog`
  - ISPConfig: `/var/log/ispconfig`

- **Common Issues**:
  - **DNS Propagation**: Allow up to 24 hours for DNS changes to propagate.
  - **DKIM/DMARC Failures**: Ensure TXT records are correctly configured.

---

## License

This project is licensed under the MIT License. See the `LICENSE` file for details.

---

## Contributing

Feel free to fork this repository and submit pull requests for improvements. Contributions are always welcome!

---

## Contact

For issues or suggestions, please open an issue in the repository or contact the project maintainer.
